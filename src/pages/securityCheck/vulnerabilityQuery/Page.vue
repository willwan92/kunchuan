<template>
	<div class="goodsPage">
		<div class="goodsTop">
      <el-tabs v-model="activeName" type="card" @tab-click="handleClick">
        <el-tab-pane label="漏洞查询" name="first">
          <template>
            <el-form :inline="true" :model="vulnerabilityQuery" class="demo-form-inline">
              <el-form-item label="项目名称">
                <el-cascader
                  :show-all-levels="false"
                  :options="pjOptions"
                  :props="{ expandTrigger: 'hover' }"
                  filterable
                  v-model="pjValue"
                >
                </el-cascader>
              </el-form-item>
              <el-form-item label="设备类型">
                <el-select v-model="vulnerabilityQuery.mold" placeholder="--请选择--">
                  <el-option label="主机" value="1"></el-option>
                  <el-option label="数据库" value="2"></el-option>
                  <el-option label="中间件" value="3"></el-option>
                  <el-option label="交换机" value="4"></el-option>
                  <el-option label="路由器" value="5"></el-option>
                  <el-option label="PLC" value="6"></el-option>
                  <el-option label="DCS" value="7"></el-option>
                </el-select>
              </el-form-item>
              <el-form-item label="ip地址">
                <el-select v-model="vulnerabilityQuery.ip" placeholder="--请选择--">
                  <el-option label="10.60.4.1" value="10.60.4.1"></el-option>
                  <el-option label="10.60.4.3" value="10.60.4.3"></el-option>
                </el-select>
              </el-form-item>
              <el-form-item>
                <el-button type="primary" @click="onSubmit">查询</el-button><slot>(带有*为必选项)</slot>
              </el-form-item>
            </el-form>
          </template>
        </el-tab-pane>
      </el-tabs>
		</div>
    <el-divider></el-divider>
    <div>
      <!--<app-table :tableTitles="tablesHeader" :tableData="tablesData"></app-table>-->
      <el-table :data="tablesData" style="width: 100%" border>
        <el-table-column type="index" width="50"></el-table-column>
        <!--<el-table-column prop="ip" label="IP"></el-table-column>-->
        <el-table-column prop="CVE" label="CVE ID" width="150"></el-table-column>
        <el-table-column prop="name" label="漏洞名称"></el-table-column>
        <el-table-column prop="level" label="级别" width="80"></el-table-column>
        <el-table-column prop="type" label="漏洞类型" width="80"></el-table-column>
        <el-table-column prop="score" label="CVS分值" width="50"></el-table-column>
        <el-table-column prop="desc" label="描述"></el-table-column>
        <el-table-column prop="solutions" label="解决方案"></el-table-column>
        <el-table-column fixed="right" label="详细" width="100">
          <template slot-scope="scope">
            <el-button @click="dialogFormVisible = true" type="text" size="small">[详细]</el-button>
          </template>
        </el-table-column>
      </el-table>
    </div>
    <el-dialog title="详细" :visible.sync="dialogFormVisible">
      <el-form :model="tablesData[0]">
        <el-form-item label="CVE ID" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].CVE" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="IP" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].ip" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="漏洞名称" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].name" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="漏洞级别" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].level" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="漏洞类型" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].type" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="CVSS 分值" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].score" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="描述" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].desc" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="解决方案" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].solutions" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="CWE ID弱点类目" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].CWE" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="# of Explots" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].explots" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="发布时间" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].publishTime" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="修订时间" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].modifyTime" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="访问级别" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].viewLevel" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="攻击路径" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].path" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="攻击复杂度" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].diff" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="身份认证" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].identify" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="机密性影响" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].influence1" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="完整性影响" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].influence2" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="可用性影响" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].influence3" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="受影响的产品及版本" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].influenced" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="产品类型" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].productType" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="参考" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].reference" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="项管模块" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].module" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="漏洞条件" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].condition" autocomplete="off"></el-input>
        </el-form-item>
        <el-form-item label="厂家" :label-width="formLabelWidth">
          <el-input v-model="tablesData[0].manufactor" autocomplete="off"></el-input>
        </el-form-item>
      </el-form>
    </el-dialog>
	</div>
</template>

<script>
  import { getCascaderOptions } from "../../../common/utils";
  import appTable from '../../../components/AppTable/index'
	export default {
		data() {
			return {
        pjOptions: null,
        pjValue: [],
			  activeName: 'first',
        vulnerabilityQuery: {
			    name: '',
          mold: '1',
          ip: '10.60.4.1'
        },
        projectName: '',
        tablesData: [
          {
            ip: '10.60.4.1',
            CVE: 'CVE-2000-0045', name: 'Windows GRANT全局密码改变漏洞',
            type: 'null', level: 'Medium',score: '6.4',
            desc: 'Windows存在漏洞。本地用户可以借助GRANT特权修改任意Windows用户的密码。',
            solutions: 'Windows has been released and is not vulnerable to this problem.        Sasha Pachev sent us the following patch on。',
            CWE: '0', explots: '0', publishTime: '2000-1-11', modifyTime: '2008-9-10', viewLevel: 'none', path: 'Remote',
            diff: 'Low', identify: 'Not required', influence1: 'Partial', influence2: 'Partial', influence3: 'Partial',
            influenced: 'Windows 3.22.27 Mysql 3.22.29 Mysql 3.23.8 ', productType: 'Application',
            reference: 'http://www.securityfocus.com/bid/926BID 926 MySQL GRANT Global Password Changing Vulnerability Release Date:2000-01-11',
            module: 'There are not any metasploit modules related to this CVE entry (Please visit www.metasploit.com for more information)',
            condition: 'null', manufactor: 'Windows'
          }, {
            CVE: 'CVE-2014-0437', name: 'Windows 拒绝服务漏洞', score: '3.5', level: 'Low', type: 'null',
            desc: 'Windows系统具有性能高、成本低、可靠性好等特点。  远程攻击者可利用该漏洞造成拒绝服务，影响数据的可用性。',
            solutions: '目前厂商已经发布了升级补丁以修复此安全问题.补丁获取链接：         http://www.oracle.com/technetwork/topics/security/cpujan2014-1972949.html'
          }, {
            CVE: 'CVE-2013-1555', name: 'Windows 安全漏洞',
            type: 'null', level: 'Medium',score: '3.5',
            desc: ' Windows，拥有各种平台的运行版本。         Windows中存在未明安全漏洞。远程授权的攻击者可通过与Server Partition相关的未知向量利用该漏洞影响可用性。',
            solutions: '目前厂商已经发布了升级补丁以修复此安全问题.补丁获取链接：         http://www.oracle.com/technetwork/topics/security/cpuapr2013-1899555.html'
          }
        ],
        dialogFormVisible: false,
        formLabelWidth: '120px'
			}
		},
    components: {appTable},
    created () {
      this.fetchPjTreeData()
    },
    methods: {
      async fetchPjTreeData() {
        const { data } = await this.fetch({
          url: "/porject/getProjectList",
          vm: this
        });

        this.pjOptions = getCascaderOptions({
          arr: data,
          label: "pjname",
          value: "id",
          filter: 'isleaf'
        });
      },
    }
	}
</script>
<style scoped lang="less">
.goodsPage {
  padding: 20px;
  border: 1px solid #ccc;
  border-radius: 5px;
  background: #fff;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
  -webkit-box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
  margin-bottom: 30px;
  &:hover {
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    -webkit-box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
  }
  .goodsTop{
    margin-top: 20px;
  }
}
</style>
